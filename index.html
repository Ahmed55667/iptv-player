<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…Ø´ØºÙ‘Ù„ IPTV Ø¹ØµØ±ÙŠ</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“º</text></svg>">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: #f1f1f1;
      padding: 15px;
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
      padding: 15px 0;
    }
    h1 {
      font-size: 1.8rem;
      background: linear-gradient(90deg, #ff7e5f, #feb47b);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #aaa;
      font-size: 0.95rem;
    }
    .controls {
      background: rgba(30, 30, 46, 0.8);
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    .input-group {
      display: flex;      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    input[type="text"] {
      flex: 1;
      min-width: 200px;
      padding: 12px;
      border: 1px solid #444;
      border-radius: 10px;
      background: #2d2d44;
      color: white;
      font-size: 1rem;
    }
    input[type="file"] {
      display: none;
    }
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    .btn-primary {
      background: linear-gradient(90deg, #ff7e5f, #feb47b);
      color: #1a1a2e;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 126, 95, 0.4);
    }
    .btn-secondary {
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      color: white;
    }
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
    }
    .tip {
      font-size: 0.85rem;
      color: #bbb;
      margin-top: 8px;
      text-align: center;
    }
    .main-content {
      display: flex;      flex-direction: column;
      gap: 20px;
    }
    @media (min-width: 768px) {
      .main-content {
        flex-direction: row;
      }
      #channel-list {
        width: 35%;
        max-height: 60vh;
        overflow-y: auto;
      }
      #player-container {
        width: 65%;
      }
    }
    #channel-list {
      background: rgba(30, 30, 46, 0.8);
      padding: 15px;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    #channel-list h3 {
      margin-bottom: 12px;
      color: #feb47b;
    }
    #channel-list a {
      display: block;
      padding: 10px;
      color: #f1f1f1;
      text-decoration: none;
      border-radius: 8px;
      margin-bottom: 6px;
      background: rgba(50, 50, 70, 0.6);
      transition: background 0.2s;
    }
    #channel-list a:hover {
      background: rgba(255, 126, 95, 0.3);
    }
    #player-container {
      background: rgba(30, 30, 46, 0.8);
      padding: 15px;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    video {
      width: 100%;
      height: auto;
      background: black;
      border-radius: 10px;      display: block;
    }
    #status {
      text-align: center;
      margin-top: 15px;
      font-size: 0.95rem;
      color: #aaa;
      min-height: 24px;
    }
    .empty {
      color: #777;
      text-align: center;
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ“º Ù…Ø´ØºÙ‘Ù„ IPTV Ø¹ØµØ±ÙŠ</h1>
      <p class="subtitle">ÙŠØ¯Ø¹Ù… Ø±ÙˆØ§Ø¨Ø· M3U ÙˆØ±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ</p>
    </header>

    <div class="controls">
      <div class="input-group">
        <input type="text" id="playlistUrl" placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ù…Ù„Ù .m3u Ù‡Ù†Ø§ (Ù…Ø«Ø§Ù„: https://iptv-org.github.io/iptv/index.m3u)" />
        <button class="btn btn-primary" onclick="loadFromUrl()">ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·</button>
      </div>
      <div class="input-group">
        <input type="file" id="fileInput" accept="*/*" onchange="loadFromFile(this.files[0])" />
        <label for="fileInput" class="btn btn-secondary">Ø±ÙØ¹ Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ</label>
      </div>
      <p class="tip">âœ“ ÙŠØ¯Ø¹Ù… Ù…Ù„ÙØ§Øª .m3u Ùˆ .m3u8 â€” âœ“ Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø­Ø³Ø§Ø¨ Ø£Ùˆ Ø¥Ù†ØªØ±Ù†Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p>
    </div>

    <div class="main-content">
      <div id="channel-list">
        <h3>Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h3>
        <div id="channels-container" class="empty">Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ù‚Ù†ÙˆØ§Øª Ø¨Ø¹Ø¯</div>
      </div>
      <div id="player-container">
        <video id="video" controls></video>
        <div id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„</div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    let channels = [];
    function loadFromUrl() {
      const url = document.getElementById('playlistUrl').value.trim();
      if (!url) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­');
        return;
      }
      setStatus('Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...');
      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù');
          return response.text();
        })
        .then(text => parseM3U(text))
        .then(list => {
          channels = list;
          renderChannels(list);
          setStatus(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${list.length} Ù‚Ù†Ø§Ø©`);
        })
        .catch(err => {
          console.error(err);
          setStatus('Ø®Ø·Ø£: ' + err.message);
        });
    }

    function loadFromFile(file) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const text = e.target.result;
          const list = parseM3U(text);
          channels = list;
          renderChannels(list);
          setStatus(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${list.length} Ù‚Ù†Ø§Ø© Ù…Ù† Ø§Ù„Ù…Ù„Ù`);
        } catch (err) {
          console.error(err);
          setStatus('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
        }
      };
      reader.readAsText(file);
    }

    function parseM3U(content) {
      const lines = content.split('\n');
      const channels = [];
      let currentChannel = null;

      for (let line of lines) {
        line = line.trim();        if (!line || line.startsWith('#EXTM3U')) continue;

        if (line.startsWith('#EXTINF')) {
          const nameMatch = line.match(/,(.*)$/);
          const name = nameMatch ? nameMatch[1].trim() : 'Ù‚Ù†Ø§Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©';
          currentChannel = { name };
        } else if (line.startsWith('http') && currentChannel) {
          currentChannel.url = line;
          channels.push(currentChannel);
          currentChannel = null;
        }
      }
      return channels;
    }

    function renderChannels(list) {
      const container = document.getElementById('channels-container');
      if (list.length === 0) {
        container.innerHTML = '<div class="empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª ØµØ§Ù„Ø­Ø©</div>';
        return;
      }
      container.innerHTML = list.map((ch, i) =>
        `<a href="#" onclick="playChannel(${i}); return false;">${ch.name}</a>`
      ).join('');
    }

    function playChannel(index) {
      const ch = channels[index];
      const video = document.getElementById('video');
      if (!ch?.url) return;

      setStatus('Ø¬Ø§Ø±Ù Ø§Ù„ØªØ´ØºÙŠÙ„...');

      // ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¨Ø« Ø§Ù„Ø³Ø§Ø¨Ù‚
      if (video.hlsPlayer) {
        video.hlsPlayer.destroy();
        video.hlsPlayer = null;
      }

      if (Hls.isSupported()) {
        const hls = new Hls();
        video.hlsPlayer = hls;
        hls.loadSource(ch.url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          video.play().catch(() => {});
          setStatus('Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„: ' + ch.name);
        });
        hls.on(Hls.Events.ERROR, () => {
          setStatus('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©');        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = ch.url;
        video.addEventListener('loadedmetadata', () => {
          video.play().catch(() => {});
          setStatus('Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„: ' + ch.name);
        }, { once: true });
      } else {
        setStatus('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±');
      }
    }

    function setStatus(text) {
      document.getElementById('status').textContent = text;
    }
  </script>
</body>
  </html>
